{"version":3,"file":"stundenplan-card.js","sources":["../src/stundenplan-card.ts"],"sourcesContent":["type StundenplanRow =\r\n  | {\r\n      time: string; // e.g. \"1. 07:45–08:30\"\r\n      cells: string[]; // e.g. [\"D\",\"Sp\",\"M\",\"D\",\"Reli\"]\r\n    }\r\n  | {\r\n      break: true;\r\n      time?: string; // e.g. \"09:20–09:40\"\r\n      label: string; // e.g. \"gr. P\"\r\n    };\r\n\r\ninterface StundenplanCardConfig {\r\n  type: string; // \"custom:stundenplan-card\"\r\n  title?: string;\r\n  days?: string[]; // [\"Mo\",\"Di\",\"Mi\",\"Do\",\"Fr\"]\r\n  rows: StundenplanRow[];\r\n\r\n  highlight_today?: boolean; // default true\r\n  today_color?: string; // rgba\r\n  cell_bg?: string; // rgba\r\n  border_color?: string; // rgba\r\n  header_bg?: string; // rgba\r\n  radius?: number; // px\r\n  font_size?: number; // px\r\n  time_col_width?: number; // px\r\n}\r\n\r\nconst DEFAULT_DAYS = [\"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\"];\r\n\r\nclass StundenplanCard extends HTMLElement {\r\n  private _config!: StundenplanCardConfig;\r\n  private _hass: any;\r\n\r\n  set hass(hass: any) {\r\n    this._hass = hass;\r\n    this._render();\r\n  }\r\n\r\n  setConfig(config: StundenplanCardConfig) {\r\n    if (!config || config.type !== \"custom:stundenplan-card\") {\r\n      throw new Error(\"Invalid config: type must be custom:stundenplan-card\");\r\n    }\r\n    if (!config.rows || !Array.isArray(config.rows) || config.rows.length === 0) {\r\n      throw new Error(\"Invalid config: rows[] is required\");\r\n    }\r\n    this._config = {\r\n      highlight_today: true,\r\n      today_color: \"rgba(56,189,248,0.22)\",\r\n      cell_bg: \"rgba(255,255,255,0.04)\",\r\n      border_color: \"rgba(255,255,255,0.22)\",\r\n      header_bg: \"rgba(255,255,255,0.10)\",\r\n      radius: 14,\r\n      font_size: 14,\r\n      time_col_width: 160,\r\n      ...config,\r\n    };\r\n    this._render();\r\n  }\r\n\r\n  getCardSize() {\r\n    return 4;\r\n  }\r\n\r\n  private _getTodayIndex(): number {\r\n    // JS: 0=So,1=Mo,...,6=Sa. We map to 0..days-1 for Mo..Fr default.\r\n    const d = new Date().getDay();\r\n    // If days starts with \"Mo\" then Mo=1 -> index 0\r\n    const days = this._config.days ?? DEFAULT_DAYS;\r\n\r\n    const map: Record<number, string> = {\r\n      1: \"Mo\",\r\n      2: \"Di\",\r\n      3: \"Mi\",\r\n      4: \"Do\",\r\n      5: \"Fr\",\r\n      6: \"Sa\",\r\n      0: \"So\",\r\n    };\r\n\r\n    const todayLabel = map[d];\r\n    return days.indexOf(todayLabel);\r\n  }\r\n\r\n  private _escape(s: string): string {\r\n    return String(s)\r\n      .replaceAll(\"&\", \"&amp;\")\r\n      .replaceAll(\"<\", \"&lt;\")\r\n      .replaceAll(\">\", \"&gt;\");\r\n  }\r\n\r\n  private _render() {\r\n    if (!this._config) return;\r\n\r\n    const days = this._config.days ?? DEFAULT_DAYS;\r\n    const todayIdx = this._config.highlight_today ? this._getTodayIndex() : -1;\r\n\r\n    const radius = this._config.radius ?? 14;\r\n    const fontSize = this._config.font_size ?? 14;\r\n    const timeW = this._config.time_col_width ?? 160;\r\n\r\n    const border = this._config.border_color ?? \"rgba(255,255,255,0.22)\";\r\n    const todayColor = this._config.today_color ?? \"rgba(56,189,248,0.22)\";\r\n    const cellBg = this._config.cell_bg ?? \"rgba(255,255,255,0.04)\";\r\n    const headerBg = this._config.header_bg ?? \"rgba(255,255,255,0.10)\";\r\n\r\n    const titleHtml = this._config.title\r\n      ? `<div class=\"title\">${this._escape(this._config.title)}</div>`\r\n      : \"\";\r\n\r\n    const headerCells = days\r\n      .map((d, i) => {\r\n        const isToday = i === todayIdx;\r\n        const bg = isToday ? todayColor : cellBg;\r\n        const leftBorder = i === 0 ? `border-left: 3px solid ${border};` : `border-left: 1px solid ${border};`;\r\n        return `<div class=\"cell head\" style=\"background:${bg}; ${leftBorder}\">${this._escape(d)}</div>`;\r\n      })\r\n      .join(\"\");\r\n\r\n    const rowsHtml = this._config.rows\r\n      .map((row) => {\r\n        if ((row as any).break) {\r\n          const r = row as Extract<StundenplanRow, { break: true }>;\r\n          // Break row: time cell + a single spanning cell\r\n          const label = this._escape(r.label);\r\n          const time = r.time ? this._escape(r.time) : \"\";\r\n          return `\r\n            <div class=\"row break\">\r\n              <div class=\"time break\">${time}</div>\r\n              <div class=\"breakcell\" style=\"grid-column: 2 / span ${days.length};\">\r\n                <span class=\"breaklabel\">${label}</span>\r\n              </div>\r\n            </div>\r\n          `;\r\n        }\r\n\r\n        const r = row as Extract<StundenplanRow, { time: string; cells: string[] }>;\r\n        const time = this._escape(r.time);\r\n\r\n        const cells = days.map((_, i) => {\r\n          const isToday = i === todayIdx;\r\n          const bg = isToday ? todayColor : cellBg;\r\n          const leftBorder = i === 0 ? `border-left: 3px solid ${border};` : `border-left: 1px solid ${border};`;\r\n          const value = this._escape(r.cells?.[i] ?? \"\");\r\n          return `<div class=\"cell\" style=\"background:${bg}; ${leftBorder}\">${value}</div>`;\r\n        }).join(\"\");\r\n\r\n        return `\r\n          <div class=\"row\">\r\n            <div class=\"time\">${time}</div>\r\n            ${cells}\r\n          </div>\r\n        `;\r\n      })\r\n      .join(\"\");\r\n\r\n    this.innerHTML = `\r\n      <ha-card class=\"card\">\r\n        ${titleHtml}\r\n        <div class=\"grid\" style=\"--timeW:${timeW}px; --radius:${radius}px; --font:${fontSize}px; --border:${border}; --headerBg:${headerBg};\">\r\n          <div class=\"row header\">\r\n            <div class=\"time head\" style=\"background:var(--headerBg);\">Stunde</div>\r\n            ${headerCells}\r\n          </div>\r\n          ${rowsHtml}\r\n        </div>\r\n      </ha-card>\r\n\r\n      <style>\r\n        .card {\r\n          border-radius: var(--radius);\r\n          overflow: hidden;\r\n        }\r\n        .title {\r\n          padding: 12px 14px;\r\n          font-weight: 800;\r\n          font-size: 16px;\r\n        }\r\n        .grid {\r\n          display: grid;\r\n          grid-auto-rows: minmax(44px, auto);\r\n          font-size: var(--font);\r\n          border: 1px solid rgba(255,255,255,0.12);\r\n          border-bottom: 3px solid rgba(255,255,255,0.22);\r\n          border-radius: var(--radius) var(--radius) 0 0;\r\n          overflow: hidden;\r\n          background: rgba(255,255,255,0.10);\r\n        }\r\n        .row {\r\n          display: grid;\r\n          grid-template-columns: var(--timeW) repeat(${days.length}, 1fr);\r\n          align-items: stretch;\r\n        }\r\n        .time, .cell {\r\n          padding: 12px 12px;\r\n          text-align: center;\r\n          font-weight: 800;\r\n        }\r\n        .time {\r\n          background: rgba(255,255,255,0.02);\r\n        }\r\n        .time.head {\r\n          font-weight: 900;\r\n        }\r\n        .cell {\r\n          background: rgba(255,255,255,0.04);\r\n        }\r\n        .row.header .cell.head {\r\n          font-weight: 900;\r\n        }\r\n        .row.break {\r\n          border-top: 2px dashed rgba(255,255,255,0.18);\r\n          border-bottom: 2px dashed rgba(255,255,255,0.18);\r\n        }\r\n        .time.break {\r\n          font-weight: 900;\r\n          opacity: 0.95;\r\n        }\r\n        .breakcell {\r\n          display: flex;\r\n          justify-content: center;\r\n          align-items: center;\r\n          padding: 10px 12px;\r\n          background: rgba(255,255,255,0.02);\r\n          border-left: 3px solid var(--border);\r\n        }\r\n        .breaklabel {\r\n          font-weight: 900;\r\n        }\r\n      </style>\r\n    `;\r\n  }\r\n}\r\n\r\ncustomElements.define(\"stundenplan-card\", StundenplanCard);\r\n"],"names":["DEFAULT_DAYS","StundenplanCard","hass","config","d","days","todayLabel","s","todayIdx","radius","fontSize","timeW","border","todayColor","cellBg","headerBg","titleHtml","headerCells","bg","leftBorder","rowsHtml","row","r","label","time","cells","_","i","_a","value"],"mappings":"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"}